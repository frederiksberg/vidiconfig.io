<style>
    .history-control {
        display: {{_displayHistory}};
    }

    .leaflet-control-locate {
        display: {{_displayLocation}};
    }

    #offcanvasLayerControlBtn {
        display: {{_displayLayer}};
    }

    .place-search {
        display: {{_displaySearch}};
    }

    .legend-btn {
        display: {{_displayLegend}};
    }

    .baselayer-toggle {
        display: {{_displayBackground}};
    }

    .full-screen-btn {
        display: {{_displayFullscreen}};
    }

    .about-btn {
        display: {{_displayAbout}};
    }

    .reset-btn {
        display: {{_displayReset}};
    }

    .leaflet-control-measurements {
        display: {{_displayMeasurement}};
    }

    .leaflet-clear-map {
        display: {{_displayClear}};
    }

    .leaflet-control-boxzoom {
        display: {{_displayBox}};
    }

    .sign-in-btn {
        display: {{_displaySignin}};
    }

    .leaflet-control-simpleMapScreenshoter {
        display: {{_displayScreenshot}};
    }

    .navbar-brand {
        display: {{_displayBrand}} !important;
    }

    .navbar-toggler {
        display: {{_displayToggler}};
    }

    .btn-outline-secondary {
        --bs-btn-bg: rgba(255, 255, 255, 0.7) !important;
    }

    /* Minimal legend style */
    .legend-top-left {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 1000;
        max-width: 250px;
        background: rgba(255, 255, 255, 0.85);
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 0.85rem;
        padding: 5px 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .legend-top-left .legend-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: bold;
        margin-bottom: 4px;
    }

    .legend-top-left .legend-body {
        max-height: 200px;
        overflow-y: auto;
    }

    .legend-top-left button {
        background: none;
        border: none;
        font-size: 1rem;
        padding: 0;
        margin: 0;
        cursor: pointer;
    }
</style>

<!-- map -->
<div id="pane" class="embed">
    <div id="container">
        <div id="map">
            <!-- Updated legend position and style -->
            <div id="legend-toast" class="legend-top-left">
                <div class="legend-header">
                    <span>{{Legend}}</span>
                    <button type="button" onclick="this.parentElement.parentElement.style.display='none';" aria-label="Close">Ã—</button>
                </div>
                <div class="legend-body" id="legend-toast-body"></div>
            </div>
        </div>
    </div>
</div>

<!-- Remaining modals and nav (unchanged) -->
<!-- About Modal -->
<div class="modal embed" id="about-modal" tabindex="-1" role="dialog" aria-labelledby="about-modalLabel">
    <div class="modal-dialog modal-fullscreen" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="about-modalLabel">{{About}}</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{Close}}"></button>
            </div>
            <div class="modal-body">
                <div class="container">
                    {{{aboutBox}}}
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{Close}}</button>
            </div>
        </div>
    </div>
</div>

<!-- Login Modal -->
<div class="offcanvas offcanvas-top" style="z-index: 1101; height: max-content" tabindex="-1" id="login-modal" aria-labelledby="offcanvasLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasLabel">{{Sign in}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body" id="login-modal-body"></div>
</div>

<!-- Navigation bar and additional offcanvas content (unchanged) -->
<!-- [Insert unchanged content here from your original template] -->

